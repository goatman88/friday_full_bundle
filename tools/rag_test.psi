param()

if (-not $env:FRIDAY_BASE) { throw "Set `FRIDAY_BASE` to your Render URL (no trailing slash)" }
if (-not $env:API_TOKEN)   { throw "Set `API_TOKEN` to your API token" }

$headers = @{
  Authorization = "Bearer $($env:API_TOKEN)"
  "Content-Type" = "application/json"
}

Write-Host "ðŸ‘‰ Indexing a note..."
$body = @{
  title  = "Acme Note"
  text   = "Acme builds rockets and coffee machines."
  source = "manual"
} | ConvertTo-Json

$resp = Invoke-RestMethod -Method Post `
  -Uri "$env:FRIDAY_BASE/api/rag/index" `
  -Headers $headers -Body $body
$resp | ConvertTo-Json -Depth 6 | Out-String | Write-Host

Write-Host "`nðŸ‘‰ Querying..."
$qbody = @{ question = "What does Acme build?" } | ConvertTo-Json

$qresp = Invoke-RestMethod -Method Post `
  -Uri "$env:FRIDAY_BASE/api/rag/query" `
  -Headers $headers -Body $qbody
$qresp | ConvertTo-Json -Depth 6 | Out-String | Write-Host


