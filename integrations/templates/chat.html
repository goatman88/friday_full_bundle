<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Friday AI</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#0b0c10; --panel:#13151a; --muted:#9aa3ad; --text:#e8edf2; --accent:#86c5ff;
      --ok:#3ac779; --err:#ff6b6b; --ring:#25425e;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background:linear-gradient(180deg,#0b0c10,#0e1218 40%,#0b0c10);
      color:var(--text); font:16px/1.45 system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      min-height:100vh; display:grid; place-items:center; padding:24px;
    }
    .card{width:min(860px,100%); background:rgba(19,21,26,.85); backdrop-filter:blur(6px);
      border:1px solid #1f2730; border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.45); overflow:hidden}
    header{padding:22px 22px 10px}
    h1{margin:0; font-size:28px}
    .sub{color:var(--muted); font-size:13px; margin-top:6px}
    .pill{display:inline-block; padding:2px 8px; border-radius:999px; font-size:11px; margin-left:8px}
    .ok{background:#0f2a1b; color:#9dffbe; border:1px solid #1c6a3c}
    .no{background:#2a1010; color:#ffc1c1; border:1px solid #6a1c1c}
    .log{height:48vh; max-height:520px; overflow:auto; padding:18px 22px 0 22px; white-space:pre-wrap}
    .bubble{margin:10px 0; padding:12px 14px; border-radius:14px; width:fit-content; max-width:90%}
    .you{background:#1b2330; border:1px solid #293346}
    .bot{background:#141a22; border:1px solid #222b36}
    .error{border-color:#43252b; background:#29181b; color:#ffd8d8}
    .ts{display:block; color:var(--muted); font-size:12px; margin-bottom:4px}
    form{display:flex; gap:10px; padding:16px 16px 18px; background:#0f141b; border-top:1px solid #1b2430}
    input[type=text]{flex:1; padding:12px 14px; border-radius:12px; border:1px solid #273140; outline:none;
      background:#0c1117; color:var(--text); transition:box-shadow .15s,border-color .15s}
    input[type=text]:focus{border-color:var(--accent); box-shadow:0 0 0 4px var(--ring)}
    button{padding:12px 18px; border-radius:12px; border:1px solid #213448; background:#0e1e2c; color:var(--text); cursor:pointer}
    button:hover{background:#123047}
    .hint{color:var(--muted); font-size:12px; padding:0 22px 20px}
    code{background:#0d1218; padding:.1rem .35rem; border-radius:6px; border:1px solid #1f2730}
  </style>
</head>
<body>
  <div class="card">
    <header>
      <h1>Friday AI<span id="modePill" class="pill">checking…</span></h1>
      <div id="sub" class="sub">Say something…</div>
    </header>

    <div id="log" class="log" aria-live="polite"></div>

    <form id="chatForm" autocomplete="off">
      <input id="msg" type="text" placeholder="Type a message" />
      <button type="submit">Send</button>
    </form>
    <div class="hint">Posts JSON to <code>/api/chat</code> as <code>{"message":"..."}</code>. If no key, replies say <em>(dev echo)</em>.</div>
  </div>

<script>
(function(){
  const log = document.getElementById('log');
  const form = document.getElementById('chatForm');
  const input = document.getElementById('msg');
  const pill = document.getElementById('modePill');
  const sub  = document.getElementById('sub');

  const ts = () => new Date().toLocaleTimeString();
  function add(html, cls='bot'){
    const div = document.createElement('div');
    div.className = `bubble ${cls}`;
    div.innerHTML = `<span class="ts">${ts()}</span>${html}`;
    log.appendChild(div); log.scrollTop = log.scrollHeight;
  }
  const esc = s => s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));

  // optional debug (may 404 in prod; that's fine)
  (async () => {
    try {
      const r = await fetch('/__meta__/debug');
      const j = r.ok ? await r.json() : null;
      const on = !!(j && j.env && j.env.openai_key_present);
      pill.textContent = on ? 'model: ON' : 'dev echo';
      pill.className = `pill ${on ? 'ok' : 'no'}`;
      sub.textContent  = on ? 'Connected to model.' : 'Dev echo mode (no key detected).';
    } catch {
      pill.textContent = 'mode: unknown';
      pill.className = 'pill no';
      sub.textContent = 'Debug endpoint missing; continuing.';
    }
  })();

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const text = (input.value || '').trim();
    if (!text) return;
    add(`You<br>${esc(text)}`, 'you');
    input.value = '';

    try {
      const r = await fetch('/api/chat', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({ message: text })   // <-- DO NOT CHANGE KEY
      });

      const ct = r.headers.get('content-type') || '';
      if (!r.ok) {
        const raw = await r.text();
        add(`Error: HTTP ${r.status}<br><code>${esc(raw)}</code>`, 'error');
        return;
      }
      if (ct.includes('application/json')) {
        const j = await r.json();
        add(esc(j.reply ?? JSON.stringify(j)));
      } else {
        add(esc(await r.text()));
      }
    } catch (err) {
      add(`Network error<br><code>${esc(String(err))}</code>`, 'error');
    }
  });
})();
</script>
</body>
</html>













